// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ========== USUÁRIOS ==========

enum ROLE {
  CLIENT
  ADVERTISER
}

enum GENDER {
  MALE
  FEMALE
  TRANS
}

model UserPreference {
  id      Int     @id @default(autoincrement())
  userId  Int
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  gender  GENDER

  @@unique([userId, gender])
}

model Locality {
  id          Int     @id @default(autoincrement())
  userId      Int     @unique
  user        User    @relation(fields: [userId], references: [id])

  country     String
  state       String
  city        String
  zone        String?
  neighborhoods String?  
}

model User {
  id          Int      @id @default(autoincrement())

  email       String   @unique
  password    String
  role        ROLE     @default(CLIENT)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  name        String
  gender      GENDER
  preferences UserPreference[]
  locality    Locality?

  producer    Producer? @relation("UserProducer")

  reviews     Review[]
}

model Review {
  id          String   @id @default(cuid())

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  profile    ProducerProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  profileId  Int

  rating      Int
  comment     String

  createdAt   DateTime @default(now())
}

// ========== PRODUTOR ==========

enum SIGNATURE {
  COPPER
  SILVER
  GOLD
  DIAMOND
}

enum STATUS {
  YELLOW
  GREEN
  RED
}

model Producer {
  id          Int       @id @default(autoincrement())
  userId      Int       @unique
  user        User      @relation("UserProducer", fields: [userId], references: [id], onDelete: Cascade)

  signature   SIGNATURE @default(COPPER)

  isVerified    Boolean   @default(false)
  verificationStatus STATUS @default(YELLOW)

  birthday    DateTime
  nationality String
  document    String
  phone       String

  documentFrontPhoto  String
  documentBackPhoto   String
  selfieWithDocument  String

  profile ProducerProfile? @relation("ProducerProfileRelation")
}

model ProducerProfile {
  id          Int        @id @default(autoincrement())
  producerId  Int        @unique
  producer    Producer   @relation("ProducerProfileRelation", fields: [producerId], references: [id], onDelete: Cascade)

  slogan      String
  description String

  scholarity  String
  languages   Json  

  hasLocal    Boolean   @default(false)
  local       ProducerLocal?

  appearance  ProducerAppearance[]
  prices      ProducerPrice[]
  services    ProducerService[]
  fetiches    ProducerFetish[]
  audience   ProducerAudience[]
  locations    ProducerLocations[]
  payments    ProducerPayment[]

  views       Int       @default(0)
  reviews     Review[]
}

//---

model ProducerLocal {
  id         Int        @id @default(autoincrement())
  profileId  Int        @unique
  profile    ProducerProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  country     String
  state       String
  city        String
  neighborhood String
  street      String?
  number      String?
  complement  String?

  amenities LocalAmenity[]
}

model AmenityOption {
  id        Int @id @default(autoincrement())
  name      String @unique
  label     String

  locals    LocalAmenity[]
}

model LocalAmenity {
  id          Int @id @default(autoincrement())
  localId     Int
  amenityId   Int
  local       ProducerLocal @relation(fields: [localId], references: [id])
  amenity     AmenityOption @relation(fields: [amenityId], references: [id])

  @@unique([localId, amenityId])
}

model AppearanceOption {
  id     Int     @id @default(autoincrement())
  name   String  @unique
  label  String
  type   String 

  producers ProducerAppearance[]
}

model ProducerAppearance {
  id          Int              @id @default(autoincrement())
  profileId   Int
  appearanceId Int
  profile     ProducerProfile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  appearance  AppearanceOption @relation(fields: [appearanceId], references: [id])

  height      Float?
  mannequin   Int?
  feet        Int?
  tattoos     Boolean?
  piercings   Boolean?
  silicone    Boolean?

  @@unique([profileId, appearanceId])
}

model PriceOption {
  id       Int     @id @default(autoincrement())
  name     String  @unique
  label    String
  producers ProducerPrice[]
}

model ProducerPrice {
  id         Int             @id @default(autoincrement())
  profileId  Int
  priceId    Int
  profile    ProducerProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  option     PriceOption     @relation(fields: [priceId], references: [id])
  
  value      Float           // o preço definido pelo produtor
  @@unique([profileId, priceId])
}

model ServiceOption {
  id        Int              @id @default(autoincrement())
  name      String           @unique
  label     String
  
  producers ProducerService[]
}

model ProducerService {
  id          Int           @id @default(autoincrement())
  profileId  Int
  serviceId   Int
  profile    ProducerProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  service     ServiceOption @relation(fields: [serviceId], references: [id])

  @@unique([profileId, serviceId])
}

model FetishOption {
  id        Int              @id @default(autoincrement())
  name      String           @unique
  label     String

  producers ProducerFetish[]
}

model ProducerFetish {
  id          Int           @id @default(autoincrement())
  profileId  Int
  fetishId    Int
  profile    ProducerProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  fetish      FetishOption  @relation(fields: [fetishId], references: [id])

  @@unique([profileId, fetishId])
}

model AudienceOption {
  id        Int               @id @default(autoincrement())
  name      String            @unique
  label     String

  producers ProducerAudience[]
}

model ProducerAudience {
  id          Int             @id @default(autoincrement())
  profileId  Int        
  audienceId  Int
  profile    ProducerProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  audience    AudienceOption  @relation(fields: [audienceId], references: [id])

  @@unique([profileId, audienceId])
}

model LocationOption {
  id        Int @id @default(autoincrement())
  name      String @unique
  label     String

  localities ProducerLocations[]
}

model ProducerLocations {
  id           Int @id @default(autoincrement())
  profileId  Int        
  locationId   Int
  profile    ProducerProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  location     LocationOption   @relation(fields: [locationId], references: [id])

  @@unique([profileId, locationId])
}

model PaymentOption {
  id        Int              @id @default(autoincrement())
  name      String           @unique
  label     String

  producers ProducerPayment[]
}

model ProducerPayment {
  id          Int           @id @default(autoincrement())
  profileId  Int
  paymentId   Int
  profile    ProducerProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  payment     PaymentOption @relation(fields: [paymentId], references: [id])

  @@unique([profileId, paymentId])
}